name = "trmnl-go-transit-proxy"
main = "src/index.js"
compatibility_date = "2026-01-23"
compatibility_flags = ["nodejs_compat"]

# Cloudflare Pages Functions (if deploying via Pages)
# deployment = { routes = [{ pattern = "/api/*", zone_name = "example.com" }] }

# Environment variables - configured via wrangler secret or .env file
# These are referenced in the Worker code via env.VARIABLE_NAME

env:
  development:
    name = "trmnl-go-transit-proxy-dev"
    routes = [
      { pattern = "localhost/api/*", zone_name = "localhost" }
    ]

  staging:
    name = "trmnl-go-transit-proxy-staging"
    routes = [
      { pattern = "staging.example.com/api/*", zone_name = "example.com" }
    ]

  production:
    name = "trmnl-go-transit-proxy"
    routes = [
      { pattern = "api.trmnl-go.com/api/*", zone_name = "trmnl-go.com" }
    ]

# Build configuration
[build]
command = "npm install && npm run build"
cwd = "./"
watch_paths = ["src/**/*.js"]

# Watch for file changes during development
[env.development.build]
watch_paths = ["src/**/*.js"]

# Package configuration
[env.development]
env_variables = { ENVIRONMENT = "development" }

[env.staging]
env_variables = { ENVIRONMENT = "staging" }

[env.production]
env_variables = { ENVIRONMENT = "production" }

# Required secrets (set via: wrangler secret put VARIABLE_NAME --env <env>)
# These should NOT be committed to git
# - ORIGIN_BASE_URL
# - ORIGIN_AUTH_TOKEN
# - EDGE_TTL
# - BROWSER_TTL
# - ORIGIN_TIMEOUT_MS

# Optional KV namespace (for future enhancements like rate limiting)
# [[kv_namespaces]]
# binding = "CACHE_CONFIG"
# id = "your-kv-namespace-id"
# preview_id = "your-preview-namespace-id"

# Optional D1 database (for future metrics/logging)
# [[d1_databases]]
# binding = "DB"
# database_name = "trmnl-go-transit"
# database_id = "your-database-id"

# Observability - Tail Workers (logs to stdout)
observability = { enabled = true }

# Analytics Engine (optional - for custom metrics)
# [analytics]
# enabled = true
